<template>
  <div class="flex flex-wrap -mx-2">
    <!-- 1st Row Widget -->
  <div class="w-full md:w-1/2 xl:w-1/4 px-2 mb-4">
      <div class="card h-full relative overflow-hidden">
        <svg
          class="absolute left-0 top-0 h-full w-full opacity-30"
          preserveAspectRatio="none"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1600 900"
        >
          <rect fill="#FFFFFF" width="1600" height="900" />
          <polygon fill="#8793cc" points="957 450 539 900 1396 900" />
          <polygon fill="#585095" points="957 450 872.9 900 1396 900" />
          <polygon fill="#7d82c9" points="-60 900 398 662 816 900" />
          <polygon fill="#5746a8" points="337 900 398 662 816 900" />
          <polygon fill="#5d5998" points="1203 546 1552 900 876 900" />
          <polygon fill="#7a6eaf" points="1203 546 1552 900 1162 900" />
          <polygon fill="#7967b9" points="641 695 886 900 367 900" />
          <polygon fill="#4f349a" points="587 900 641 695 886 900" />
          <polygon fill="#7549b5" points="1710 900 1401 632 1096 900" />
          <polygon fill="#a49dbd" points="1710 900 1401 632 1365 900" />
          <polygon fill="#cdc3d8" points="1210 900 971 687 725 900" />
          <polygon fill="#9485c0" points="943 900 1210 900 971 687" />
        </svg>

        <div class="z-2 relative text-primary">
          <div class="flex align-items-center justify-content-between">
            <div class="text-xl font-semibold mb-3 text-black-alpha-90">
              Ratings
            </div>
            <Chip
              label="Year of 2022"
              class="bg-primary-100 text-primary-900 font-semibold"
            ></Chip>
          </div>
          <div>
            <div class="text-4xl mb-2 font-medium">
              14k
              <span>
                <i class="pi pi-fw pi-arrow-up text-green-500"></i>
              </span>
            </div>
            <span>
              <span class="text-900 text-lg font-semibold mr-1">+ 2.5%</span>
              <span class="text-600 text-sm">vs last month</span>
            </span>
          </div>
        </div>
      </div>
    </div>
  <div class="w-full md:w-1/2 xl:w-1/4 px-2 mb-4">
      <div class="card h-full relative overflow-hidden">
        <svg
          class="absolute left-0 top-0 h-full w-full opacity-30"
          preserveAspectRatio="none"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1600 900"
          width="100%"
        >
          <rect fill="#ffffff" width="540" height="450" />
          <defs>
            <linearGradient
              id="a"
              gradientUnits="userSpaceOnUse"
              x1="0"
              x2="0"
              y1="0"
              y2="100%"
              gradientTransform="rotate(343,720,341)"
            >
              <stop offset="0" stop-color="#ffffff" />
              <stop offset="1" stop-color="#B1B2FF" />
            </linearGradient>
            <pattern
              patternUnits="userSpaceOnUse"
              id="b"
              width="830"
              height="691.7"
              x="0"
              y="0"
              viewBox="0 0 1080 900"
            >
              <g fill-opacity="0.14">
                <polygon fill="#444" points="90 150 0 300 180 300" />
                <polygon points="90 150 180 0 0 0" />
                <polygon fill="#AAA" points="270 150 360 0 180 0" />
                <polygon fill="#DDD" points="450 150 360 300 540 300" />
                <polygon fill="#999" points="450 150 540 0 360 0" />
                <polygon points="630 150 540 300 720 300" />
                <polygon fill="#DDD" points="630 150 720 0 540 0" />
                <polygon fill="#444" points="810 150 720 300 900 300" />
                <polygon fill="#FFF" points="810 150 900 0 720 0" />
                <polygon fill="#DDD" points="990 150 900 300 1080 300" />
                <polygon fill="#444" points="990 150 1080 0 900 0" />
                <polygon fill="#DDD" points="90 450 0 600 180 600" />
                <polygon points="90 450 180 300 0 300" />
                <polygon fill="#666" points="270 450 180 600 360 600" />
                <polygon fill="#AAA" points="270 450 360 300 180 300" />
                <polygon fill="#DDD" points="450 450 360 600 540 600" />
                <polygon fill="#999" points="450 450 540 300 360 300" />
                <polygon fill="#999" points="630 450 540 600 720 600" />
                <polygon fill="#FFF" points="630 450 720 300 540 300" />
                <polygon points="810 450 720 600 900 600" />
                <polygon fill="#DDD" points="810 450 900 300 720 300" />
                <polygon fill="#AAA" points="990 450 900 600 1080 600" />
                <polygon fill="#444" points="990 450 1080 300 900 300" />
                <polygon fill="#222" points="90 750 0 900 180 900" />
                <polygon points="270 750 180 900 360 900" />
                <polygon fill="#DDD" points="270 750 360 600 180 600" />
                <polygon points="450 750 540 600 360 600" />
                <polygon points="630 750 540 900 720 900" />
                <polygon fill="#444" points="630 750 720 600 540 600" />
                <polygon fill="#AAA" points="810 750 720 900 900 900" />
                <polygon fill="#666" points="810 750 900 600 720 600" />
                <polygon fill="#999" points="990 750 900 900 1080 900" />
                <polygon fill="#999" points="180 0 90 150 270 150" />
                <polygon fill="#444" points="360 0 270 150 450 150" />
                <polygon fill="#FFF" points="540 0 450 150 630 150" />
                <polygon points="900 0 810 150 990 150" />
                <polygon fill="#222" points="0 300 -90 450 90 450" />
                <polygon fill="#FFF" points="0 300 90 150 -90 150" />
                <polygon fill="#FFF" points="180 300 90 450 270 450" />
                <polygon fill="#666" points="180 300 270 150 90 150" />
                <polygon fill="#222" points="360 300 270 450 450 450" />
                <polygon fill="#FFF" points="360 300 450 150 270 150" />
                <polygon fill="#444" points="540 300 450 450 630 450" />
                <polygon fill="#222" points="540 300 630 150 450 150" />
                <polygon fill="#AAA" points="720 300 630 450 810 450" />
                <polygon fill="#666" points="720 300 810 150 630 150" />
                <polygon fill="#FFF" points="900 300 810 450 990 450" />
                <polygon fill="#999" points="900 300 990 150 810 150" />
                <polygon points="0 600 -90 750 90 750" />
                <polygon fill="#666" points="0 600 90 450 -90 450" />
                <polygon fill="#AAA" points="180 600 90 750 270 750" />
                <polygon fill="#444" points="180 600 270 450 90 450" />
                <polygon fill="#444" points="360 600 270 750 450 750" />
                <polygon fill="#999" points="360 600 450 450 270 450" />
                <polygon fill="#666" points="540 600 630 450 450 450" />
                <polygon fill="#222" points="720 600 630 750 810 750" />
                <polygon fill="#FFF" points="900 600 810 750 990 750" />
                <polygon fill="#222" points="900 600 990 450 810 450" />
                <polygon fill="#DDD" points="0 900 90 750 -90 750" />
                <polygon fill="#444" points="180 900 270 750 90 750" />
                <polygon fill="#FFF" points="360 900 450 750 270 750" />
                <polygon fill="#AAA" points="540 900 630 750 450 750" />
                <polygon fill="#FFF" points="720 900 810 750 630 750" />
                <polygon fill="#222" points="900 900 990 750 810 750" />
                <polygon fill="#222" points="1080 300 990 450 1170 450" />
                <polygon fill="#FFF" points="1080 300 1170 150 990 150" />
                <polygon points="1080 600 990 750 1170 750" />
                <polygon fill="#666" points="1080 600 1170 450 990 450" />
                <polygon fill="#DDD" points="1080 900 1170 750 990 750" />
              </g>
            </pattern>
          </defs>
          <rect x="0" y="0" fill="url(#a)" width="100%" height="100%" />
          <rect x="0" y="0" fill="url(#b)" width="100%" height="100%" />
        </svg>

        <div class="z-2 relative text-primary">
          <div class="flex align-items-center justify-content-between">
            <div class="text-xl font-semibold mb-3 text-black-alpha-90">
              Retentions
            </div>
            <Chip
              label="Year of 2022"
              class="bg-primary-100 text-primary-900 text-sm font-semibold"
            ></Chip>
          </div>
          <div>
            <div class="text-4xl mb-2 font-medium">
              2K
              <span>
                <i class="pi pi-fw pi-arrow-up text-green-500"></i>
              </span>
            </div>
            <span>
              <span class="text-900 text-lg font-semibold mr-1">+ .5%</span>
              <span class="text-600 text-sm">vs last month</span>
            </span>
          </div>
        </div>
      </div>
    </div>
  <div class="w-full md:w-1/2 xl:w-1/2 px-2 mb-4">
      <div class="card h-full">
        <div class="flex align-items-start justify-content-between mb-4">
          <div>
            <div class="text-900 text-xl font-semibold">Transactions</div>
            <span class="text-600">Summary of transactions </span>
          </div>
          <div class="flex flex-column gap-2">
            <label for="date">Periode</label>
            <Calendar
              id="date"
              v-model="today"
              selectionMode="range"
              :maxDate="maxDate"
              dateFormat="dd/mm/yy"
              :manualInput="false"
              inputClass="w-full"
            />
          </div>
        </div>
        <div class="grid">
          <div class="flex gap-2 col-12 md:col-4">
            <GridWidgetMini
              title="Orders"
              valuePrefix="$"
              value="2.500"
              icon="pi-book"
              color="green"
            />
          </div>
          <div class="flex gap-2 col-12 md:col-4">
            <GridWidgetMini
              title="Customer"
              valuePrefix="+"
              value="2.5K"
              icon="pi-users"
              color="orange"
            />
          </div>

          <div class="flex gap-2 col-12 md:col-4">
            <GridWidgetMini
              title="Revenue"
              valuePrefix="$"
              value="200.5K"
              icon="pi-dollar"
              color="blue"
            />
          </div>
        </div>
      </div>
    </div>
    <!-- 2nd Row Widget -->
  <div class="w-full xl:w-1/4 px-2 mb-4">
      <div class="card h-auto">
        <div class="text-900 text-xl font-semibold">Customers Insights</div>
        <div class="text-600 text-sm mb-3">Current vs New Customers</div>
        <Chart
          type="bar"
          :data="chartBarData"
          :options="chartBarOptions"
          class="h-16rem"
        ></Chart>
      </div>
    </div>
  <div class="w-full xl:w-1/4 px-2 mb-4">
      <div class="card h-auto">
        <div class="text-900 text-xl font-semibold">Trends</div>
        <div class="text-600 text-sm mb-3">Current vs New Customers</div>
        <Chart
          type="line"
          :data="chartBarData"
          :options="chartBarOptions"
          class="h-16rem"
        ></Chart>
      </div>
    </div>
  <div class="w-full xl:w-1/2 px-2 mb-4">
      <div class="card h-full">
        <div class="text-900 text-xl font-semibold mb-3">
          Weekly Sales Overview
        </div>
        <div class="grid">
          <Chart
            type="doughnut"
            :data="chartDoughnutData"
            :options="chartDoughnutOptions"
            class="col-12 xl:col-6 mx-auto"
          ></Chart>
          <div class="col-12 xl:col-6 mx-auto">
            <div class="flex gap-2 w-full">
              <GridWidgetMini
                title="Number of Sales"
                :value="
                  chartDoughnutDataset
                    ? formatCurrency(
                        calculateTotal(
                          chartDoughnutDataset.map(
                            (item: chartVal) => item.value,
                          ),
                        ),
                      )
                    : 0
                "
                icon="pi-dollar"
                color="purple"
              />
            </div>
            <Divider type="solid" layout="horizontal" />
            <div class="grid text-800">
              <div
                v-for="(item, index) in chartDoughnutDataset"
                :key="index"
                class="col-12 2xl:col-6"
              >
                <span>
                  <i
                    class="pi pi-fw pi-circle-on"
                    :style="{ color: item.color }"
                  ></i>
                  {{ item.label }}
                </span>
                <div class="text-lg font-medium">
                  {{ formatCurrency(item.value) }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 3rd Row Widget -->

  <div class="w-full lg:w-1/2 px-2 mb-4">
      <div class="card h-full">
        <div class="flex align-items-center justify-content-between mb-3">
          <div class="text-900 text-xl font-semibold">Activity Timeline</div>
        </div>
        <div class="flex justify-content-start row-gap-3 mt-6">
          <Timeline
            :value="events"
            :pt="{
              opposite: {
                class: 'hidden',
              },
            }"
          >
            <template #marker="slotProps">
              <span
                :class="
                  slotProps.item.status === 'Delivered'
                    ? 'bg-pink-500'
                    : slotProps.item.status === 'Shipped'
                      ? 'bg-orange-500'
                      : slotProps.item.status === 'Processing'
                        ? 'bg-purple-500'
                        : 'bg-green-500'
                "
                class="flex w-2rem h-2rem align-items-center justify-content-center text-white border-circle z-1 shadow-1"
              >
              </span>
            </template>
            <template #content="slotProps">
              <div class="flex justify-content-between w-full">
                <div>
                  <div class="text-900 text-lg font-semibold">
                    {{ slotProps.item.status }}
                  </div>
                  <div class="text-600 text-sm">
                    {{ slotProps.item.description }}
                  </div>
                  <div
                    v-if="slotProps.item.attachment"
                    class="text-600 my-2 p-2 border-round w-full font-semibold"
                  >
                    <div v-if="slotProps.item.attachment.file_type === 'pdf'">
                      <i class="pi pi-fw pi-file-pdf p-2 text-red-500 mr-3"></i>
                      <span>
                        {{ slotProps.item.attachment.file_name }}
                      </span>
                    </div>
                    <div
                      v-else-if="
                        slotProps.item.attachment.file_type === 'image'
                      "
                    >
                      <i class="pi pi-fw pi-image p-2 text-blue-500 mr-3"></i>
                      <span>
                        {{ slotProps.item.attachment.file_name }}
                      </span>
                    </div>
                  </div>
                </div>
                <span class="text-600 text-sm">{{ slotProps.item.date }}</span>
              </div>
            </template>
          </Timeline>
        </div>
      </div>
    </div>

  <div class="w-full lg:w-1/2 px-2 mb-4">
      <div class="card">
        <div class="text-900 text-xl font-semibold mb-3">Meeting Schedule</div>

        <ul class="list-none p-0 m-0">
          <li
            class="flex align-items-center p-3 mb-3 border-bottom-1 surface-border"
          >
            <img
              alt="brands"
              src="/demo/images/banking/airbnb.png"
              class="w-3rem flex-shrink-0 mr-3"
            />
            <div class="flex flex-column">
              <span class="text-xl font-medium text-900 mb-1">Airbnb</span>
              <span>Meeting Airbnb Headquater</span>
            </div>
            <span class="text-xl text-900 ml-auto font-semibold"
              >05/23/2022</span
            >
          </li>
          <li
            class="flex align-items-center p-3 mb-3 border-bottom-1 surface-border"
          >
            <img
              alt="brands"
              src="/demo/images/banking/amazon.png"
              class="w-3rem flex-shrink-0 mr-3"
            />
            <div class="flex flex-column">
              <span class="text-xl font-medium text-900 mb-1">Amazon</span>
              <span>Meeting at Amazon Headquater</span>
            </div>
            <span class="text-xl text-900 ml-auto font-semibold"
              >05/23/2022</span
            >
          </li>
          <li
            class="flex align-items-center p-3 mb-3 border-bottom-1 surface-border"
          >
            <img
              alt="brands"
              src="/demo/images/banking/nike.svg"
              class="w-3rem flex-shrink-0 mr-3 border-circle"
            />
            <div class="flex flex-column">
              <span class="text-xl font-medium text-900 mb-1"
                >Nike NYC Store</span
              >
              <span>Meeting at Nike NYC</span>
            </div>
            <span class="text-xl text-900 ml-auto font-semibold"
              >05/23/2022</span
            >
          </li>
          <li
            class="flex align-items-center p-3 mb-3 border-bottom-1 surface-border"
          >
            <img
              alt="brands"
              src="/demo/images/banking/starbucks.svg"
              class="w-3rem flex-shrink-0 mr-3"
            />
            <div class="flex flex-column">
              <span class="text-xl font-medium text-900 mb-1">Starbucks</span>
              <span>Meeting at Nike NYC</span>
            </div>
            <span class="text-xl text-900 ml-auto font-semibold"
              >05/23/2022</span
            >
          </li>
          <li class="flex align-items-center p-3 mb-3">
            <img
              alt="brands"
              src="/demo/images/banking/amazon.png"
              class="w-3rem flex-shrink-0 mr-3"
            />
            <div class="flex flex-column">
              <span class="text-xl font-medium text-900 mb-1">Amazon</span>
              <span>Meeting at Nike NYC</span>
            </div>
            <span class="text-xl text-900 ml-auto font-semibold"
              >05/23/2022</span
            >
          </li>
        </ul>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { onMounted, ref, watch } from 'vue';
import { useLayout } from '@/ui/composables/Layout';
// import GridWidgetMini from '@/components/Widgets/GridWidgetMini.vue';

type chartVal = {
  label: string;
  value: number;
  color: string;
};

const { layoutConfig } = useLayout();
const price = ref(0);
const chartData = ref<any>(null);
const chartBarData = ref<any>(null);
const chartBarOptions = ref<any>(null);
const chartDoughnutData = ref<any>(null);
const chartDoughnutDataset = ref<any>(null);
const chartDoughnutOptions = ref<any>(null);
const today = ref([new Date(), new Date()]);
const maxDate = ref(new Date());
const chartOptions = ref<any>(null);
const payments = ref([
  { name: 'Electric Bill', amount: 75.6, paid: true, date: '06/04/2022' },
  { name: 'Water Bill', amount: 45.5, paid: true, date: '07/04/2022' },
  { name: 'Gas Bill', amount: 45.2, paid: false, date: '12/04/2022' },
  { name: 'Internet Bill', amount: 25.9, paid: true, date: '17/04/2022' },
  { name: 'Streaming', amount: 40.9, paid: false, date: '20/04/2022' },
]);

const events = ref([
  {
    status: 'Meeting',
    date: '15/10/2020 10:30',
    description: 'Meeting with sales team',
    announcer: 'John Doe',
    attachment: {
      url: 'https://www.primefaces.org/primereact/showcase/showcase/images/avatar/john.png',
      file_type: 'image',
      file_name: 'avatar.png',
    },
    icon: 'pi pi-circle-on',
    color: '#9C27B0',
  },
  {
    status: 'Processing',
    date: '15/10/2020 14:00',
    description: 'Prepare documents',
    announcer: 'John Doe',
    attachment: {
      url: 'https://www.primefaces.org/primereact/showcase/showcase/images/avatar/john.png',
      file_type: 'pdf',
      file_name: 'document.pdf',
    },
    icon: 'pi pi-circle-on',
    color: '#673AB7',
  },
  {
    status: 'Shipped',
    date: '15/10/2020 16:15',
    description: 'Ship documents to customers',
    icon: 'pi pi-circle-on',
    announcer: 'John Doe',
    attachment: {
      url: 'https://www.primefaces.org/primereact/showcase/showcase/images/avatar/john.png',
      file_type: 'pdf',
      file_name: 'document.pdf',
    },
    color: '#FF9800',
  },
  {
    status: 'Delivered',
    date: '16/10/2020 10:00',
    description: 'Deliver documents to customer',
    announcer: 'John Doe',
    attachment: {
      url: 'https://www.primefaces.org/primereact/showcase/showcase/images/avatar/john.png',
      file_type: 'pdf',
      file_name: 'document.pdf',
    },
    icon: 'pi pi-circle-on',
    color: '#607D8B',
  },
]);

maxDate.value.setDate(maxDate.value.getDate() + 1);

onMounted(() => {
  initChart();
  const dataset = chartDoughnutData.value.datasets[0];
  chartDoughnutDataset.value = chartDoughnutData.value.labels.map(
    (label: string, index: number) => {
      return {
        label,
        value: dataset.data[index],
        color: dataset.backgroundColor[index],
      };
    },
  );
});

watch(() => layoutConfig.colorScheme, () => {
  initChart();
});

const initChart = () => {
  const documentStyle = getComputedStyle(document.documentElement);
  const textColor = documentStyle.getPropertyValue('--text-color');
  const textColorSecondary = documentStyle.getPropertyValue(
    '--text-color-secondary',
  );
  const surfaceBorder = documentStyle.getPropertyValue('--surface-border');

  chartData.value = {
    labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
    datasets: [
      {
        label: 'Income',
        data: [6500, 5900, 8000, 8100, 5600, 5500, 4000],
        fill: false,
        tension: 0.4,
        borderColor: documentStyle.getPropertyValue('--green-500'),
      },
      {
        label: 'Expenses',
        data: [1200, 5100, 6200, 3300, 2100, 6200, 4500],
        fill: true,
        borderColor: '#6366f1',
        tension: 0.4,
        backgroundColor: 'rgba(99,102,220,0.2)',
      },
    ],
  };

  chartOptions.value = {
    animation: {
      duration: 0,
    },
    plugins: {
      legend: {
        labels: {
          color: textColor,
        },
      },
      tooltip: {
        callbacks: {
          label: function (context: any) {
            let label = context.dataset.label || '';

            if (label) {
              label += ': ';
            }

            if (context.parsed.y !== null) {
              label += new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
              }).format(context.parsed.y);
            }
            return label;
          },
        },
      },
    },
    scales: {
      x: {
        ticks: {
          color: textColorSecondary,
        },
        grid: {
          color: surfaceBorder,
        },
      },
      y: {
        ticks: {
          color: textColorSecondary,
        },
        grid: {
          color: surfaceBorder,
        },
      },
    },
  };

  chartBarData.value = {
    labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
    datasets: [
      {
        label: 'Current',
        fill: false,
        tension: 0.4,
        backgroundColor: documentStyle.getPropertyValue('--blue-500'),
        borderColor: documentStyle.getPropertyValue('--blue-500'),
        data: [65, 59, 80, 81, 56, 55, 40],
      },
      {
        label: 'New Customers',
        fill: false,
        tension: 0.4,
        backgroundColor: documentStyle.getPropertyValue('--pink-500'),
        borderColor: documentStyle.getPropertyValue('--pink-500'),
        data: [28, 48, 40, 19, 86, 27, 90],
      },
    ],
  };
  chartBarOptions.value = {
    maintainAspectRatio: false,
    aspectRatio: 0.8,
    plugins: {
      legend: {
        labels: {
          color: textColor,
        },
      },
    },
    scales: {
      x: {
        ticks: {
          color: textColorSecondary,
          font: {
            weight: 500,
          },
        },
        grid: {
          display: false,
          drawBorder: false,
        },
      },
      y: {
        ticks: {
          color: textColorSecondary,
        },
        grid: {
          color: surfaceBorder,
          drawBorder: false,
        },
      },
    },
  };

  chartDoughnutData.value = {
    labels: ['Cars', 'Motorcycle', 'Parts'],
    datasets: [
      {
        data: [7288273, 2873737, 4873737],
        backgroundColor: [
          documentStyle.getPropertyValue('--pink-500'),
          documentStyle.getPropertyValue('--blue-500'),
          documentStyle.getPropertyValue('--gray-200'),
        ],
        hoverBackgroundColor: [
          documentStyle.getPropertyValue('--pink-400'),
          documentStyle.getPropertyValue('--blue-400'),
          documentStyle.getPropertyValue('--gray-400'),
        ],
      },
    ],
  };

  chartDoughnutOptions.value = {
    plugins: {
      legend: {
        labels: {
          color: textColor,
        },
      },
    },
  };
};

const formatCurrency = (value: number) => {
  return value.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
};

const calculateTotal = (value: []) => {
  return value.reduce((a: number, b: number) => a + b, 0);
};
</script>
